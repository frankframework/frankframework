<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="https://schemas.frankframework.org/FrankConfig.xsd">
	<Adapter name="ReplaceInputAndPreserve" description="Test the functioning of the attributes getInputFromSessionKey, getInputFromFixedValue, preserveInput and storeResultInSessionKey">
		<Receiver>
			<JavaListener name="ibis4test-ReplaceInputAndPreserve" serviceName="ibis4test-ReplaceInputAndPreserve" />
		</Receiver>
		<Pipeline>
			<Exits>
				<Exit name="EXIT" state="SUCCESS" />
			</Exits>
			<SwitchPipe name="SwitchAction" xpathExpression="request/@action" />
			<!-- getFromPreserveAndStore-Pipe -->
			<PutInSessionPipe name="getFromPreserveAndStore-Pipe" sessionKey="requestKey" value="&lt;abc/&gt;" />
			<XsltPipe name="getFromPreserveAndStore-Pipe2" styleSheetName="/Parameters/WrapInput.xslt"
                  preserveInput="true" getInputFromSessionKey="requestKey" storeResultInSessionKey="storedResultKey" /> <!-- preserve input to restore it later, replace original input with fixed value, store wrapped result, return original input -->
			<XsltPipe name="getFromPreserveAndStore-Pipe4" styleSheetName="/Parameters/ShowParam.xslt" >
				<Param name="param1" sessionKey="requestKey" />      <!--  fixed value -->
				<Param name="param2" sessionKey="storedResultKey" /> <!--  wrapped fixed value -->
				<Param name="param3" />                              <!--  result of pipe, that is preserved original message -->
				<Forward name="success" path="EXIT" />
			</XsltPipe>

			<!-- getFromPreserveAndStore-SenderWrapper -->
			<PutInSessionPipe name="getFromPreserveAndStore-SenderWrapper" sessionKey="requestKey" value="&lt;abc/&gt;" />
			<SenderPipe name="getFromPreserveAndStore-SenderWrapper2">
				 <!-- preserve input to restore it later, replace original input with fixed value, store wrapped result, return original input -->
				<SenderSeriesSender getInputFromSessionKey="requestKey" preserveInput="true" storeResultInSessionKey="storedResultKey">
					<XsltSender styleSheetName="/Parameters/WrapInput.xslt" />
				</SenderSeriesSender>
			</SenderPipe>
			<XsltPipe name="getFromPreserveAndStore-SenderWrapper4" styleSheetName="/Parameters/ShowParam.xslt" >
				<Param name="param1" sessionKey="requestKey" />      <!--  fixed value -->
				<Param name="param2" sessionKey="storedResultKey" /> <!--  wrapped fixed value -->
				<Param name="param3" />                              <!--  result of pipe, that is preserved original message -->
				<Forward name="success" path="EXIT" />
			</XsltPipe>
		</Pipeline>
	</Adapter>

	<Adapter name="ReplaceInputFromMissingSessionKey">
		<Receiver>
			<JavaListener name="ibis4test-ReplaceInputFromMissingSessionKey" serviceName="ibis4test-ReplaceInputFromMissingSessionKey" />
		</Receiver>
		<Pipeline>
			<Exits>
				<Exit name="EXIT" state="SUCCESS"/>
			</Exits>

			<PutInSessionPipe name="PutValueInSession" sessionKey="requestKey" value="&lt;abc/&gt;" />
			<EchoPipe name="TestMissingKeyInputReplacement" defaultValue="" getInputFromSessionKey="missingKey"/>
		</Pipeline>
	</Adapter>
</Module>
