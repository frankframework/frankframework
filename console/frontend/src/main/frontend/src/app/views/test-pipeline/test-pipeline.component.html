<div class="wrapper wrapper-content animated fadeInRight">
  @for (alert of state; track alert) {
    <ngb-alert
      data-cy-test-pipeline="runResult"
      data-cy="test-pipeline__alert"
      [dismissible]="false"
      [type]="alert.type"
      >{{ alert.message }}</ngb-alert
    >
  }
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h4>Test a PipeLine</h4>
        </div>
        <div class="ibox-content">
          <form role="form" appQuickSubmitForm (submit)="submit($event)">
            <div class="row form-group">
              <label class="col-sm-3 control-label">Configuration</label>
              <div class="col-sm-9">
                <app-combobox
                  name="configuration"
                  data-cy-test-pipeline="selectConfig"
                  data-cy="test-pipeline__config__input"
                  [options]="configurationOptions()"
                  [(selectedOption)]="selectedConfiguration"
                  (selectedOptionChange)="setSelectedConfiguration()"
                />
              </div>
            </div>
            <div class="row form-group">
              <label class="col-sm-3 control-label label-height-30">Select an adapter</label>
              <div class="col-sm-9">
                <app-combobox
                  name="adapters"
                  data-cy-test-pipeline="selectAdapter"
                  data-cy="test-pipeline__adapter__input"
                  [options]="adapterOptions"
                  [disabled]="selectedConfiguration === ''"
                  [(selectedOption)]="form.adapter"
                />
              </div>
            </div>
            @for (sessionKey of formSessionKeys; track sessionKey.key; let index = $index) {
              <div class="row form-group test-pipeline-session-keys">
                <label class="col-sm-3 control-label label-height-30">
                  @if (index === 0) {
                    <span>Session Key</span>
                  }
                </label>
                <div class="col-sm-4">
                  <input
                    name="sessionKey{{ index }}"
                    data-cy-test-pipeline="sessionKeyName"
                    class="form-control"
                    placeholder="Name"
                    type="text"
                    [(ngModel)]="sessionKey.key"
                    (blur)="updateSessionKeys(sessionKey)"
                  />
                </div>
                <div class="col-sm-5">
                  <input
                    name="sessionKeyValue{{ index }}"
                    data-cy-test-pipeline="sessionKeyValue"
                    class="form-control"
                    placeholder="Value"
                    type="text"
                    [(ngModel)]="sessionKey.value"
                    (blur)="updateSessionKeys(sessionKey)"
                  />
                </div>
              </div>
            }
            <div class="row form-group">
              <label class="col-sm-3 control-label label-height-30">Upload File</label>
              <div class="col-sm-9 col-md-4">
                <app-input-file-upload (fileUpdated)="updateFile($event)" />
              </div>
              <div class="hidden-xs hidden-sm col-md-1">
                <label class="control-label label-height-30 pull-right">Encoding</label>
              </div>
              <div class="hidden-xs hidden-sm col-md-4">
                <input class="form-control" name="encoding" type="text" [(ngModel)]="form.encoding" />
              </div>
            </div>
            <div class="row form-group hidden-md hidden-lg">
              <div class="col-sm-3">
                <label class="control-label label-height-30">Encoding</label>
              </div>
              <div class="col-sm-9">
                <input class="form-control" name="encoding" type="text" [(ngModel)]="form.encoding" />
              </div>
            </div>
            <div class="row form-group">
              <label class="col-sm-3 control-label label-height-30">Message</label>
              <div class="col-sm-9">
                <app-monaco-editor
                  data-cy-test-pipeline="message"
                  class="form-control"
                  data-cy="test-pipeline__message__input"
                  style="height: 200px"
                  [options]="{ language: 'text' }"
                  [actions]="editorActions"
                  [(value)]="form.message"
                />
              </div>
            </div>
            <div class="row form-group">
              <div class="col-sm-3 m-t-md">
                <button class="btn btn-info btn-w-m font-bold" type="button" (click)="reset()">Reset</button>
              </div>
              <div class="col-sm-3 m-t-md">
                <button
                  data-cy-test-pipeline="send"
                  class="btn btn-primary btn-w-m font-bold"
                  type="submit"
                  [ladda]="processingMessage"
                >
                  Send
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    @if (result) {
      <div class="col-lg-12">
        <div class="ibox float-e-margins">
          <div class="ibox-title">
            <h4>Result</h4>
          </div>
          <div class="ibox-content">
            <pre class="ng-binding" contenteditable="true" data-cy="test-pipeline__result">{{ result }}</pre>
          </div>
        </div>
      </div>
    }
  </div>
</div>
